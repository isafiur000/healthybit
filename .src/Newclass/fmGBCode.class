' Gambas class file

Private $sClass As String
Private $cSymbol As String
Private $compAll As String[]

Private $sValue As String

Public Sub Run(sComponents As String[]) As String

  $compAll = sComponents
  If Me.ShowModal() Then Return $sValue

End

Public Sub Form_Open()

  Me.Center
  ListBox1.List = GBClassList(TextBox1.Text)
  TextBox1.SetFocus

End

Private Function GBClassList(xtxt As String) As String[]

  Dim xcls As Class
  Dim xxx As String[]

  xxx = New String[]
  For Each xcls In Classes
    If xcls.Name Like xtxt & "*" Then
      xxx.Add(xcls.Name)
    Endif
  Next
  Return xxx

End

Private Function GBClassSymbol(scls As String, cSymb As String) As String[]

  Dim xcls As Class
  Dim xsym As String
  Dim xxx As String[]

  xxx = New String[]
  For Each xcls In Classes
    If xcls.Name = scls Then
      For Each xsym In xcls.Symbols
        If xsym Like cSymb & "*" Then
          xxx.Add(xsym)
        Endif
      Next
    Endif
  Next
  Return xxx

End

Public Sub TextBox1_Change()

  ListBox1.List = GBClassList(TextBox1.Text)

End

Public Sub TextBox1_KeyRelease()

  If Key.Code = Key.Down Then
    ListBox1.SetFocus
  Endif

End

Public Sub ListBox1_KeyRelease()

  If Key.Code = Key.Return Or If Key.Code = Key.Enter Or If Key.Code = Key.AltKey Then
    $sClass = ListBox1.Text
    ListBox2.List = GBClassSymbol(ListBox1.Text, TextBox2.Text)
    TextBox2.SetFocus
  Endif

End

Public Sub TextBox2_Change()

  ListBox2.List = GBClassSymbol(ListBox1.Text, TextBox2.Text)

End

Public Sub TextBox2_KeyRelease()

  If Key.Code = Key.Down Then
    ListBox2.SetFocus
  Endif

End

Public Sub ListBox2_KeyRelease()

  If Key.Code = Key.Return Or If Key.Code = Key.Enter Or If Key.Code = Key.AltKey Then
    $cSymbol = ListBox2.Text
    $sValue = $sClass & "." & $cSymbol
    Me.Close(True)
  Endif

End

Public Sub Form_KeyRelease()

  If Key.Code = Key.Esc Then
    Me.Close
  Endif

End
