' Gambas class file

Private $sPatNo As String

Public Sub _new(sPatNo As String)

  $sPatNo = sPatNo

End

Public Sub Form_Open()

  Dim res As Result

  cmbcategory.List = modControlSub.GetDirectFillresult(modDatabase.$myConn.Exec("select fldcategory as col from tblcategorylist"))
  cmbrank.List = modControlSub.GetDirectFillresult(modDatabase.$myConn.Exec("select flditem as col from tblranks"))
  cmbunit.List = modControlSub.GetDirectFillresult(modDatabase.$myConn.Exec("select flditem as col from tblunits"))

  res = modDatabase.$myConn.Exec("select fldcategory,fldrank,fldunit from tblpatientinfo where fldpatientval=&1", $sPatNo)                         ''
  If res.Available Then
    cmbcategory.Text = res["fldcategory"]
    cmbrank.Text = res["fldrank"]
    cmbunit.Text = res["fldunit"]
  Endif

End

Public Sub btnChange_Click()

  Me.Close()

End

Public Sub btnOK_Click()

  Dim res As Result

  res = modDatabase.$myConn.Edit("tblpatientinfo", "fldpatientval=&1", $sPatNo)
  If res.Available Then
    res["fldcategory"] = cmbcategory.Text
    res["fldrank"] = cmbrank.Text
    res["fldunit"] = cmbunit.Text
    res.Update
    Balloon.Info(("Information updated"), btnOK)
    Balloon.Delay = modBasic.$BalloonDelay
  Endif

End
