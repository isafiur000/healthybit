' Gambas class file

Public Sub Form_Open()

  Me.Center
  cmbagefir.List = ["Days", "Months", "Years"]
  cmbagelas.List = ["Days", "Months", "Years"]
  ShowGridData()

End

Private Sub ClearAll()

  txtagegroup.Text = ""
  txtagefir.Value = 0
  txtagelas.Value = 0
  cmbagefir.Text = ""
  cmbagelas.Text = ""

End

Public Sub btnageadd_Click()

  Dim res As Result
  Dim xfir As Float
  Dim xlas As Float

  If cmbagefir.Text = "Months" Then
    xfir = CInt(txtagefir.Value * 30)
  Else If cmbagefir.Text = "Years" Then
    xfir = CInt(txtagefir.Value * 365)
  Else
    xfir = CInt(txtagefir.Value)
  Endif

  If cmbagelas.Text = "Months" Then
    xlas = CInt(txtagelas.Value * 30)
  Else If cmbagelas.Text = "Years" Then
    xlas = CInt(txtagelas.Value * 365)
  Else
    xlas = CInt(txtagelas.Value)
  Endif

  res = modDatabase.$myConn.Create("tblagegroups")
  res["fldgroup"] = Trim(txtagegroup.Text)
  res["fldlower"] = xfir
  res["fldhigher"] = xlas
  res.Update
  ShowGridData()
  ClearAll()

End

Private Sub ShowGridData()

  Dim res As Result
  Dim Column As Integer
  Dim fld As ResultField

  res = modDatabase.$myConn.Exec("select fldgroup,fldlower,fldhigher from tblagegroups")
  GridView1.Clear
  GridView1.Columns.Count = 3
  GridView1.Rows.Count = res.Count

  For Each res
    Column = 0
    For Each fld In res.Fields
      modGeneralMain.GridExplicitDecoration(GridView1, res.Index, Column)
      GridView1[res.Index, Column].Text = res[fld.Name]
      Column = Column + 1
    Next
  Next
  GridView1.Row = 0

  With GridView1
    .Rows.Height = modBasic.$AppGridRowHeight
    .Columns[0].Width = 200 * modBasic.$AppWidthRatio
    .Columns[1].Width = 125 * modBasic.$AppWidthRatio
    .Columns[2].Width = 125 * modBasic.$AppWidthRatio

    .Columns[0].Text = "Age Group"
    .Columns[1].Text = "Minimum"
    .Columns[2].Text = "Maximum"
  End With

End

Public Sub btndelete_Click()

  If GridView1.Rows.Selection.Count Then
    modDatabase.$myConn.Delete("tblagegroups", "fldgroup=&1", GridView1[GridView1.Row, 0].Text)
    ShowGridData()
  Endif

End
