' Gambas class file

Private $rData2 As Result
Private $aMyFields2 As String[]
Private $sValue As String

Public Sub Run(res As Result) As String

  $rData2 = res

  If Me.ShowModal() Then Return $sValue

End

Public Sub Form_Open()

  modGeneralMain.ArrangeFormCentre(Me, "False")
  CompleteGrid()

End

Public Sub Form_KeyRelease()

  If Key.Code = Key.Esc Then
    Me.Close
  Endif

End

Private Sub CompleteGrid()

  $aMyFields2 = New String[]
  modGridView.ReadSmallData(GridView2, $rData2, $aMyFields2)

  With GridView2
    .Columns[0].Width = 1
    .Columns[1].Width = 150 * modBasic.$AppWidthRatio
    .Columns[2].Width = 1
    .Columns[3].Width = 250 * modBasic.$AppWidthRatio
    .Columns[4].Width = 150 * modBasic.$AppWidthRatio
    .Columns[5].Width = 25 * modBasic.$AppWidthRatio
    .Columns[6].Width = 1

    .Columns[1].Text = "DateTime"
    .Columns[3].Text = "Department"
    .Columns[4].Text = "Consultant"
  End With

End

Public Sub GridView2_Data(Row As Integer, Column As Integer)

  $rData2.MoveTo(Row)
  modGeneralMain.GridViewDecoration(GridView2, Row)
  If Column = 1 Then
    GridView2.Data.Text = modReportVar.GetDateTimeReport($rData2[$aMyFields2[Column]], gb.GeneralDate)
  Else If Column = 4 Then
    GridView2.Data.Text = modGeneral.GetUserFullName($rData2[$aMyFields2[Column]])
  Else If Column = 5 Then
    GridView2.Data.Picture = Picture["icon:/tiny/apply"]
    GridView2.Data.Text = ""
  Else
    GridView2.Data.Text = $rData2[$aMyFields2[Column]]
  Endif

End

Public Sub GridView2_Click()

  If GridView2.Rows.Selection.Count
    If GridView2[GridView2.Row, 6].Text = "tblconsult" Then
      $sValue = CStr(GridView2[GridView2.Row, 0].Text) & "|" & "Consultation"
    Else If GridView2[GridView2.Row, 6].Text = "tblopvisit" Then
      $sValue = CStr(GridView2[GridView2.Row, 0].Text) & "|" & "OP Visit"
    Endif
    Me.Close(True)
  Endif

End

Public Sub GridView2_KeyRelease()

  If Key.Code = Key.Return Or If Key.Code = Key.Enter Then
    If GridView2.Rows.Selection.Count
      If GridView2[GridView2.Row, 6].Text = "tblconsult" Then
        $sValue = CStr(GridView2[GridView2.Row, 0].Text) & "|" & "Consultation"
      Else If GridView2[GridView2.Row, 6].Text = "tblopvisit" Then
        $sValue = CStr(GridView2[GridView2.Row, 0].Text) & "|" & "OP Visit"
      Endif
      Me.Close(True)
    Endif
  Endif

End
