' Gambas class file

Private $encid As String
Private $rData As Result
Private $aMyFields As String[]

Public Sub _new(encid As String)

  $encid = encid

End

Public Sub Form_Open()

  cmbstatus.List = ["Continue", "Completed", "Discontinue", "On Hold", "Change", "ReWrite", "Cancelled"]
  cmbstatus.Text = "Continue"
  LoadMedicineGrid()

End

Public Sub btnshow_Click()

  LoadMedicineGrid()

End

Private Sub LoadMedicineGrid()

  Dim sFieldLst As String[]
  Dim sql As String

  sFieldLst = ["fldid", "fldroute", "flditem", "flddose", "fldfreq", "flddays", "fldcurval", "fldid", "fldid", "flddirection", "fldadminsite", "fldmixing"]
  sql = "select " & sFieldLst.Join(",") & " from tblinpatdosing where fldencounterval=&1 and fldcurval=&2"
  $rData = modDatabase.$myConn.Exec(sql, $encid, cmbstatus.Text)
  $aMyFields = New String[]
  modGridView.ReadSmallData(GridView1, $rData, $aMyFields)

  With GridView1
    .Columns[0].Width = 1
    .Columns[1].Width = 75 * modBasic.$AppWidthRatio
    .Columns[2].Width = 300 * modBasic.$AppWidthRatio
    .Columns[3].Width = 75 * modBasic.$AppWidthRatio
    .Columns[4].Width = 100 * modBasic.$AppWidthRatio
    .Columns[5].Width = 50 * modBasic.$AppWidthRatio
    .Columns[6].Width = 100 * modBasic.$AppWidthRatio
    .Columns[7].Width = 75 * modBasic.$AppWidthRatio
    .Columns[8].Width = 25 * modBasic.$AppWidthRatio
    .Columns[9].Width = 150 * modBasic.$AppWidthRatio
    .Columns[10].Width = 150 * modBasic.$AppWidthRatio
    .Columns[11].Width = 150 * modBasic.$AppWidthRatio

    .Columns[1].Text = "Route"
    .Columns[2].Text = "Medicine"
    .Columns[3].Text = "Dose"
    .Columns[4].Text = "Freq"
    .Columns[5].Text = "Days"
    .Columns[6].Text = "Status"
    .Columns[7].Text = "Count"
    .Columns[9].Text = "Direction"
    .Columns[10].Text = "Administration"
    .Columns[11].Text = "Compounding"
  End With

End

Public Sub GridView1_Data(Row As Integer, Column As Integer)

  $rData.MoveTo(Row)
  modGeneralMain.GridViewDecoration(GridView1, Row)
  GridView1.Data.Text = $rData[$aMyFields[Column]]

End
