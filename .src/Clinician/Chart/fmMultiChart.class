' Gambas class file

Private aPanel As New Object[50]
Private aObj As New Object[50]
Private aObk As New Object[50]
Private aObjx As New Object[50]
Private aObj1 As New Object[50]
Private aObHBox As New Object[50]
Private aObVal As New Object[50]
Private aObBox As New Object[50]
Private aObButt As New Object[50]

Private bObHBox As New Object[50]
Private bObj1 As New Object[50]
Private bObVal As New Object[50]
Private bObBox As New Object[50]
Private bObButt As New Object[50]
Private bsepLine As New Object[50]

Private $encid As String
Private $sTitle As String
Private $xParamVar As Variant[]
Private $xalllow As Boolean

Private $unt As String
Private AppFactor As Float
Private $UserRestrict As String[]
Private $PatientNum As String

Public Sub _new(encid As String, sTitle As String, unt As String)

  $encid = encid
  $sTitle = sTitle

  $unt = unt
  Me.Title = "ENCID: " & $encid

End

Public Sub Form_Open()

  Dim xstatus As String

  modGeneralMain.ArrangeEmbedForms(Me, Panel1, "Vertical")
  Me.Icon = Picture[modGeneralMain.$strLogo]
  txtpatientname.Text = modPatient.GetPatientNameByEnc($encid)
  $PatientNum = modPatient.GetPatientNoByEnc($encid)
  txtgender.Text = modPatient.GetPatientSex($encid)
  xstatus = modPatient.CurrentAdmissionStatus($encid)
  $xalllow = modPatient.EnableClinicForm(xstatus)
  $UserRestrict = modBasic.$ClinicDisableCompo

  modBasic.LoadClinicalChartSetting()
  AppFactor = modBasic.$AppScaleFactor
  GetVariables()

  rboneday.Value = True
  Slider1.Value = 10
  rbtable.Value = True
  SetOptions()
  Panel6.Visible = True
  ListContainer1.Visible = False

End

Public Sub Form_Close()

  modGeneralMain.RecordFormExit(Me)

End

Private Sub GetVariables()

  Dim res As Result
  Dim sColl As Collection

  Dim aColl As Collection
  Dim xList As String

  $xParamVar = New Variant[]
  If $sTitle = "Essential Examinations" Then
    For Each aColl In modTableCache.$ExaminationCompVar
      If aColl["fldcategory"] = "Essential Examinations" Then
        sColl = New Collection
        sColl.Add("Examination", "Category")
        sColl.Add(aColl["fldexamid"], "Examination")
        sColl.Add("", "Component")
        sColl.Add(aColl["fldtype"], "Type")
        sColl.Add("", "Comment")
        sColl.Add(aColl["fldsysconst"], "Constant")
        sColl.Add(aColl["fldtanswertype"], "Option")
        If aColl["fldtype"] = "Qualitative" And If aColl["fldsysconst"] Then
          xList = modAllExam.SelectExamOptionList("Exam", aColl["fldexamid"]).join(";")
          sColl.Add(xList, "OptionValues")
        Else
          sColl.Add("", "OptionValues")
        Endif
        $xParamVar.Add(sColl)
      Endif
    Next

  Else
    res = modDatabase.$myConn.Exec("select fldcategory,fldexam,fldsubexam,fldtype,fldcomment,fldsysconst,fldoption,fldselection from tbldepartchart where fldtitle=&1 and (fldcomp=&2 or fldcomp=&3) ORDER BY fldexamorder", $sTitle, modBasic.$compID, "%")
    If res.Available Then
      For Each res
        sColl = New Collection
        sColl.Add(res["fldcategory"], "Category")
        sColl.Add(res["fldexam"], "Examination")
        sColl.Add(res["fldsubexam"], "Component")
        sColl.Add(res["fldtype"], "Type")
        sColl.Add(res["fldcomment"], "Comment")
        sColl.Add(res["fldsysconst"], "Constant")
        sColl.Add(res["fldoption"], "Option")
        If res["fldtype"] = "Qualitative" And If res["fldsysconst"] Then
          xList = modAllExam.SelectExamOptionList("Exam", res["fldexam"]).join(";")
          sColl.Add(xList, "OptionValues")
        Else
          sColl.Add(res["fldselection"], "OptionValues")
        Endif
        $xParamVar.Add(sColl)
      Next
    Endif

  Endif

End

Public Sub rbchart_Click()

  SetOptions()

End

Public Sub rbtable_Click()

  SetOptions()

End

Private Sub SetOptions()

  If rbchart.Value = True Then
    rballday.Visible = True
    rballvisit.Visible = True
    rboneday.Text = "24 Hours"
    rbtwoday.Text = "48 Hours"
    rbthreeday.Text = "72 Hours"
    rbweek.Text = "1 Week"
    ListContainer1.Visible = True
    Panel6.Visible = False
    ScrollView1.Visible = False

  Else If rbtable.Value = True Then
    rballday.Visible = False
    rballvisit.Visible = False
    rboneday.Text = "Minute"
    rbtwoday.Text = "Hourly"
    rbthreeday.Text = "Daily"
    rbweek.Text = "Monthly"
    ListContainer1.Visible = False
    Panel6.Visible = True
    ScrollView1.Visible = True

  Endif

End

Public Sub btnrefresh_Click()

  If rbchart.Value = True Then
    LoadControls()
  Else If rbtable.Value = True Then
    LoadTablesExam()
    GetDataEntry()
  Endif

End

Private Sub LoadTablesExam()

  Dim xfir As Date
  Dim xlast As Date
  Dim xcolm As Integer

  Dim i As Integer
  Dim j As Integer
  Dim xdiff As Integer

  xdiff = 0 - spncolumn.Value
  GridView2.Clear()
  GridView2.Rows.Count = $xParamVar.Count
  If rboneday.Value = True Then
    xfir = modDate.StartSqlTenMinute(DateAdd(Now(), gb.Minute, xdiff * 10))
    xlast = modDate.StartSqlTenMinute(DateAdd(Now(), gb.Minute, 10))
    xcolm = (DateDiff(xfir, xlast, gb.Minute) / 10)
  Else If rbtwoday.Value = True Then
    xfir = modDate.StartSqlHour(DateAdd(Now(), gb.Hour, xdiff))
    xlast = modDate.StartSqlHour(DateAdd(Now(), gb.Hour, 1))
    xcolm = DateDiff(xfir, xlast, gb.Hour)
  Else If rbthreeday.Value = True Then
    xfir = modDate.StartSqlDate(DateAdd(Now(), gb.Day, xdiff))
    xlast = modDate.StartSqlDate(DateAdd(Now(), gb.Day, 1))
    xcolm = DateDiff(xfir, xlast, gb.Day)
  Else If rbweek.Value = True Then
    xfir = modDate.StartSqlMonth(DateAdd(Now(), gb.Month, xdiff))
    xlast = modDate.StartSqlMonth(DateAdd(Now(), gb.Month, 1))
    xcolm = DateDiff(xfir, xlast, gb.Month)
  Endif
  GridView2.Columns.Count = xcolm + 2

  With GridView2
    .Rows.Height = modBasic.$AppGridRowHeight
    For j = 0 To GridView2.Columns.Count - 1
      If j = 0 Then
        .Columns[j].Width = 175 * modBasic.$AppWidthRatio
        .Columns[j].Text = "Examination"
      Else If j = 1 Then
        If chkcomment.Value = True Then
          .Columns[j].Width = 100 * modBasic.$AppWidthRatio
          .Columns[j].Text = "Comment"
        Else
          .Columns[j].Width = 1
        Endif
      Else
        .Columns[j].Width = 64 * modBasic.$AppWidthRatio
        If rboneday.Value = True Then
          .Columns[j].Text = modReportVar.GetDateTimeReport(DateAdd(xfir, gb.Minute, j * 10), gb.ShortTime)
        Else If rbtwoday.Value = True Then
          .Columns[j].Text = modReportVar.GetDateTimeReport(DateAdd(xfir, gb.Hour, j), gb.ShortTime)
        Else If rbthreeday.Value = True Then
          .Columns[j].Text = modDate.GetDateOnlyInFormatForAll(DateAdd(xfir, gb.Day, j), modBasic.$DateFormat, "DateOnly")
        Else If rbweek.Value = True Then
          .Columns[j].Text = modDate.GetDateOnlyInFormatForAll(DateAdd(xfir, gb.Month, j), modBasic.$DateFormat, "YearMonth")
        Endif
      Endif
    Next
  End With

  For i = 0 To $xParamVar.Count - 1
    For j = 0 To GridView2.Columns.Count - 1
      If j = 0 Then
        If $xParamVar[i]["Component"] Then
          GridView2[i, j].Text = $xParamVar[i]["Component"] & " [" & $xParamVar[i]["Examination"] & "]"
        Else
          GridView2[i, j].Text = $xParamVar[i]["Examination"]
        Endif
      Else If j = 1 Then
        GridView2[i, j].Text = $xParamVar[i]["Comment"]
      Else

        If $xParamVar[i]["Category"] = "Examination" Then
          If rboneday.Value = True Then
            GridView2[i, j].Text = GetExamValueByDate($PatientNum, $xParamVar[i], DateAdd(xfir, gb.Minute, j * 10))
          Else If rbtwoday.Value = True Then
            GridView2[i, j].Text = GetExamValueByDate($PatientNum, $xParamVar[i], DateAdd(xfir, gb.Hour, j))
          Else If rbthreeday.Value = True Then
            GridView2[i, j].Text = GetExamValueByDate($PatientNum, $xParamVar[i], DateAdd(xfir, gb.Day, j))
          Else If rbweek.Value = True Then
            GridView2[i, j].Text = GetExamValueByDate($PatientNum, $xParamVar[i], DateAdd(xfir, gb.Month, j))
          Endif
        Else If $xParamVar[i]["Category"] = "Laboratory" Then
          If rboneday.Value = True Then
            GridView2[i, j].Text = GetLabValueByDate($PatientNum, $xParamVar[i], DateAdd(xfir, gb.Minute, j * 10))
          Else If rbtwoday.Value = True Then
            GridView2[i, j].Text = GetLabValueByDate($PatientNum, $xParamVar[i], DateAdd(xfir, gb.Hour, j))
          Else If rbthreeday.Value = True Then
            GridView2[i, j].Text = GetLabValueByDate($PatientNum, $xParamVar[i], DateAdd(xfir, gb.Day, j))
          Else If rbweek.Value = True Then
            GridView2[i, j].Text = GetLabValueByDate($PatientNum, $xParamVar[i], DateAdd(xfir, gb.Month, j))
          Endif
        Endif

      Endif
    Next
  Next

  GridView2.Scroll(GridView2.X + GridView2.Width, GridView2.Y)

End

Private Function GetLabValueByDate(patNo As String, xColl As Collection, xDate As Date) As String

  Dim res As Result
  Dim xx As String
  Dim xfir As Date
  Dim xlast As Date

  If rboneday.Value = True Then
    xfir = modDate.StartSqlTenMinute(xDate)
    xlast = modDate.EndSqlTenMinute(xDate)
  Else If rbtwoday.Value = True Then
    xfir = modDate.StartSqlHour(xDate)
    xlast = modDate.EndSqlHour(xDate)
  Else If rbthreeday.Value = True Then
    xfir = modDate.StartSqlDate(xDate)
    xlast = modDate.EndSqlDate(xDate)
  Else If rbweek.Value = True Then
    xfir = modDate.StartSqlMonth(xDate)
    xlast = modDate.EndSqlMonth(xDate)
  Endif

  If xColl["Component"] Then
    res = modDatabase.$myConn.Exec("select tblpatlabsubtest.fldreport as fldreport from (tblpatlabsubtest inner join tblpatlabtest on (tblpatlabtest.fldid=tblpatlabsubtest.fldtestid and tblpatlabtest.fldencounterval=tblpatlabsubtest.fldencounterval)) inner join tblencounter on tblpatlabtest.fldencounterval=tblencounter.fldencounterval  where tblencounter.fldpatientval=&1 and tblpatlabtest.fldsave_report=&2 and tblpatlabtest.fldtestid=&3 and tblpatlabsubtest.fldsubtest=&4 and tblpatlabtest.fldtime_sample>=&5 and tblpatlabtest.fldtime_sample<=&6 ORDER BY tblpatlabtest.fldtime_sample", patNo, True, xColl["Examination"], xColl["Component"], xfir, xlast)         ''
    If res.Available Then
      res.MoveLast
      If res["fldreport"] Then
        xx = res["fldreport"]
      Else
        xx = ""
      Endif
    Else
      xx = ""
    Endif

  Else
    res = modDatabase.$myConn.Exec("select tblpatlabtest.fldreportquali as fldreportquali,tblpatlabtest.fldreportquanti as fldreportquanti from tblpatlabtest inner join tblencounter on tblpatlabtest.fldencounterval=tblencounter.fldencounterval  where tblencounter.fldpatientval=&1 and tblpatlabtest.fldsave_report=&2 and tblpatlabtest.fldtestid=&3 and tblpatlabtest.fldtime_sample>=&4 and tblpatlabtest.fldtime_sample<=&5 ORDER BY tblpatlabtest.fldtime_sample", patNo, True, xColl["Examination"], xfir, xlast)
    If res.Available Then
      res.MoveLast
      If res["fldreportquanti"] Then
        xx = CStr(res["fldreportquanti"])
      Else
        xx = res["fldreportquali"]
      Endif
    Else
      xx = ""
    Endif

  Endif
  Return xx

End

Private Function GetExamValueByDate(patNo As String, xColl As Collection, xDate As Date) As String

  Dim res As Result
  Dim xx As String
  Dim xfir As Date
  Dim xlast As Date
  Dim aColl As Collection

  If rboneday.Value = True Then
    xfir = modDate.StartSqlTenMinute(xDate)
    xlast = modDate.EndSqlTenMinute(xDate)
  Else If rbtwoday.Value = True Then
    xfir = modDate.StartSqlHour(xDate)
    xlast = modDate.EndSqlHour(xDate)
  Else If rbthreeday.Value = True Then
    xfir = modDate.StartSqlDate(xDate)
    xlast = modDate.EndSqlDate(xDate)
  Else If rbweek.Value = True Then
    xfir = modDate.StartSqlMonth(xDate)
    xlast = modDate.EndSqlMonth(xDate)
  Endif

  If xColl["Component"] Then
    If xColl["Option"] = "Clinical Scale" Then
      res = modDatabase.$myConn.Exec("select tblpatientexam.fldrepquali as fldrepquali,tblpatientexam.fldrepquanti as fldrepquanti from tblpatientexam inner join tblencounter on tblpatientexam.fldencounterval=tblencounter.fldencounterval  where tblencounter.fldpatientval=&1 and tblpatientexam.fldsave=&2 and tblpatientexam.fldhead=&3 and tblpatientexam.fldtime>=&4 and tblpatientexam.fldtime<=&5 ORDER BY tblpatientexam.fldtime", patNo, True, xColl["Examination"], xfir, xlast)
      If res.Available Then
        res.MoveLast
        If res["fldrepquali"] Then
          aColl = JSON.Decode(res["fldrepquali"])
          If aColl Then
            xx = aColl[xColl["Component"]]
          Endif
        Else
          xx = ""
        Endif
      Else
        xx = ""
      Endif

    Else
      res = modDatabase.$myConn.Exec("select tblpatientsubexam.fldreport as fldreport from (tblpatientsubexam inner join tblpatientexam  on (tblpatientexam.fldid=tblpatientsubexam.fldheadid and tblpatientexam.fldencounterval=tblpatientsubexam.fldencounterval)) inner join tblencounter on tblpatientexam.fldencounterval=tblencounter.fldencounterval  where tblencounter.fldpatientval=&1 and tblpatientexam.fldsave=&2 and tblpatientexam.fldhead=&3 and tblpatientsubexam.fldsubtexam=&4 and tblpatientexam.fldtime>=&5 and tblpatientexam.fldtime<=&6 ORDER BY tblpatientexam.fldtime", patNo, True, xColl["Examination"], xColl["Component"], xfir, xlast)
      If res.Available Then
        res.MoveLast
        If res["fldreport"] Then
          xx = res["fldreport"]
        Else
          xx = ""
        Endif
      Else
        xx = ""
      Endif

    Endif

  Else
    res = modDatabase.$myConn.Exec("select tblpatientexam.fldrepquali as fldrepquali,tblpatientexam.fldrepquanti as fldrepquanti from tblpatientexam inner join tblencounter on tblpatientexam.fldencounterval=tblencounter.fldencounterval  where tblencounter.fldpatientval=&1 and tblpatientexam.fldsave=&2 and tblpatientexam.fldhead=&3 and tblpatientexam.fldtime>=&4 and tblpatientexam.fldtime<=&5 ORDER BY tblpatientexam.fldtime", patNo, True, xColl["Examination"], xfir, xlast)
    If res.Available Then
      res.MoveLast
      If res["fldrepquanti"] Then
        xx = CStr(res["fldrepquanti"])
      Else
        xx = res["fldrepquali"]
      Endif
    Else
      xx = ""
    Endif

  Endif

  Return xx

End

Private Sub GetDataEntry()

  Dim i As Integer

  If pnlgridentry.Children.Count Then
    pnlgridentry.Children.Clear()
  Endif

  For i = 0 To $xParamVar.Count - 1
    If $xParamVar[i]["Component"] Then
    Else
      If $xParamVar[i]["Category"] = "Examination" Then
        bObj1[i] = New TextLabel(pnlgridentry) As "ExamLabelGroup"
        bObHBox[i] = New HBox(pnlgridentry)
        If $xParamVar[i]["Type"] = "Quantitative" Then
          bObVal[i] = New ValueBox(bObHBox[i])
          bObButt[i] = New ToolButton(bObHBox[i]) As "SaveExam"
        Else
          bObBox[i] = New ComboBox(bObHBox[i])
          bObButt[i] = New ToolButton(bObHBox[i]) As "SaveExam"
        Endif
        bsepLine[i] = New Separator(pnlgridentry)
      Endif
    Endif
  Next

  ShowEntryControls()

End

Private Sub ShowEntryControls()

  Dim i As Integer
  Dim xcount As Integer

  xcount = 0
  For i = 0 To $xParamVar.Count - 1
    If $xParamVar[i]["Component"] Then
    Else
      If $xParamVar[i]["Category"] = "Examination" Then

        With bObj1[i]
          .Height = 24 * AppFactor
          ' .Width = pnlgridentry.Width
          .Text = $xParamVar[i]["Examination"]
          .Tag = i
        End With

        With bObHBox[i]
          .Height = 24 * AppFactor
          .Tag = $xParamVar[i]["Constant"]
        End With

        If $xParamVar[i]["Type"] = "Quantitative" Then
          With bObVal[i]
            .Width = 100 * AppFactor
            .Tag = i
          End With
          With bObButt[i]
            .Width = 25 * AppFactor
            .Picture = Picture["icon:/small/apply"]
            .Tag = i
          End With

        Else
          With bObBox[i]
            .Expand = True
            ' .Width = 200 * AppFactor
            .List = Split($xParamVar[i]["OptionValues"], ";")
            .Tag = i
          End With
          With bObButt[i]
            .Width = 25 * AppFactor
            .Picture = Picture["icon:/small/apply"]
            .Tag = i
          End With

        Endif

        With bsepLine[i]
          .Height = 15 * AppFactor
        End With

        xcount = xcount + 1
      Endif
    Endif
  Next

  pnlgridentry.Height = xcount * (24 + 24 + 20) * AppFactor

End

Public Sub SaveExam_Click()

  Dim i As Integer
  Dim xcateg As String

  i = Last.Tag

  If $sTitle = "Essential Examinations" Then
    xcateg = "Essential Examinations"
  Else
    xcateg = "Physician Examinations"
  Endif
  If bObVal[i] And If bObVal[i].Value Then
    modClinSub.AddQuantiData($encid, "", $xParamVar[i]["Examination"], "", bObVal[i].Value, False, xcateg, bObHBox[i].Tag)
    Balloon.Info(("Information saved"), bObButt[i])
    Balloon.Delay = modBasic.$BalloonDelay

  Else If bObBox[i] And If bObBox[i].Text Then
    modClinSub.AddQualiData($encid, "", $xParamVar[i]["Examination"], "", bObBox[i].Text, False, xcateg, bObHBox[i].Tag)
    Balloon.Info(("Information saved"), bObButt[i])
    Balloon.Delay = modBasic.$BalloonDelay

  Endif
  LoadTablesExam()

End

''====================== Chart ==========================
Private Sub LoadControls()

  Dim i As Integer

  If ListContainer1.Children.Count Then
    ListContainer1.Children.Clear()
  Endif

  For i = 0 To $xParamVar.Count - 1
    If i < 49 Then
      aPanel[i] = New VBox(ListContainer1)
      aObHBox[i] = New HBox(aPanel[i])
      aObj1[i] = New TextLabel(aObHBox[i]) As "TextLabelGroup"

      If $xParamVar[i]["Category"] = "Examination" Then
        If $xParamVar[i]["Type"] = "Quantitative" Then
          If $xalllow = True Then
            If $xParamVar[i]["Component"] Then
            Else
              aObVal[i] = New ValueBox(aObHBox[i])
              aObButt[i] = New ToolButton(aObHBox[i]) As "SaveButton"
            Endif
          Endif
          aObjx[i] = New ScrollView(aPanel[i]) As "ScrollGroup"
          aObj[i] = New PictureBox(aObjx[i]) As "PictureBoxgroup"
        Else
          If $xalllow = True Then
            If $xParamVar[i]["Component"] Then
            Else
              aObBox[i] = New ComboBox(aObHBox[i])
              aObButt[i] = New ToolButton(aObHBox[i]) As "SaveButton"
            Endif
          Endif
          aObk[i] = New ListBox(aPanel[i]) As "ListGroup"
        Endif
      Else If $xParamVar[i]["Category"] = "Laboratory" Then
        If $xParamVar[i]["Type"] = "Quantitative" Then
          aObjx[i] = New ScrollView(aPanel[i]) As "ScrollGroup"
          aObj[i] = New PictureBox(aObjx[i]) As "PictureBoxgroup"
        Else
          aObk[i] = New ListBox(aPanel[i]) As "ListGroup"
        Endif
      Endif

    Endif
  Next

  FillCHartItems(Slider1.Value * 10)

End

Private Sub FillCHartItems(sHt As Integer)

  Dim i As Integer
  Dim sPath As String

  For i = 0 To $xParamVar.Count - 1
    If i < 49 Then

      With aPanel[i]
        .Height = (30 + sHt) * AppFactor
      End With

      With aObHBox[i]
        .Height = 30 * AppFactor
        .Tag = $xParamVar[i]["Constant"]
      End With

      With aObj1[i]
        .Left = 0
        .Expand = True
        .Height = 25 * AppFactor
        .Top = 0
        If $xParamVar[i]["Component"] Then
          .Text = "<b>" & $xParamVar[i]["Component"] & " [" & $xParamVar[i]["Examination"] & "]" & "</b>"
        Else
          .Text = "<b>" & $xParamVar[i]["Examination"] & "</b>"
        Endif
        .Tag = i
      End With

      If $xParamVar[i]["Category"] = "Examination" Then
        If $xParamVar[i]["Type"] = "Quantitative" Then
          If $xalllow = True Then
            If $xParamVar[i]["Component"] Then
            Else
              With aObVal[i]
                .Left = 250 * AppFactor
                .Width = 75 * AppFactor
                .Height = 25 * AppFactor
                .Top = 0
                .Tag = i
              End With
              With aObButt[i]
                .Left = 300 * AppFactor
                .Width = 50 * AppFactor
                .Height = 25 * AppFactor
                .Top = 0
                .Picture = Picture["icon:/small/apply"]
                .Tag = i
              End With
            Endif
          Endif

          With aObjx[i]
            .Height = sHt * AppFactor
            .Left = 0
            .Tag = i
          End With
          With aObj[i]
            .Background = Color.White
            .Expand = True
            .AutoResize = True
            .Height = (sHt - 20) * AppFactor
            .Left = 0
            .Top = 0
            .Tag = i
          End With
          sPath = ""
          If rballvisit.Value = True Then
            sPath = modClinSub.FillQuantiExamChartHistory(aObj[i].Height, $encid, $PatientNum, $xParamVar[i]["Examination"], ChartHourVal())
          Else
            sPath = modClinSub.FillQuantiExamChart(aObj[i].Height, $encid, $xParamVar[i]["Examination"], ChartHourVal())
          Endif
          If sPath Then
            Try aObj[i].Picture = Picture.Load(sPath)
          Endif

        Else
          If $xalllow = True Then
            If $xParamVar[i]["Component"] Then
            Else
              With aObBox[i]
                .Left = 250 * AppFactor
                .Width = 150 * AppFactor
                .Height = 25 * AppFactor
                .Top = 0
                .List = Split($xParamVar[i]["OptionValues"], ";")
                .Tag = i
              End With
              With aObButt[i]
                .Left = 300 * AppFactor
                .Width = 50 * AppFactor
                .Height = 25 * AppFactor
                .Top = 0
                .Picture = Picture["icon:/small/apply"]
                .Tag = i
              End With
            Endif
          Endif

          With aObk[i]
            .Height = sHt * AppFactor
            .Left = 0
            .Width = (Panel1.Width - 75) * AppFactor
            .List = modClinic.UniExamValueList($encid, $xParamVar[i]["Examination"])
            .Tag = i
          End With

        Endif

      Else If $xParamVar[i]["Category"] = "Laboratory" Then
        If $xParamVar[i]["Type"] = "Quantitative" Then
          With aObjx[i]
            .Height = sHt * AppFactor
            .Left = 0
            .Tag = i
          End With
          With aObj[i]
            .Background = Color.White
            .Expand = True
            .AutoResize = True
            .Height = (sHt - 20) * AppFactor
            .Left = 0
            .Top = 0
            .Tag = i
          End With
          sPath = ""
          If rballvisit.Value = True Then
            sPath = modLabSub.FillQuantiTestChartHistory(aObj[i].Height, $encid, $PatientNum, $xParamVar[i]["Examination"], $unt, ChartHourVal())
          Else
            sPath = modLabSub.FillQuantiTestChart(aObj[i].Height, $encid, $xParamVar[i]["Examination"], $unt, ChartHourVal())
          Endif
          If sPath Then
            Try aObj[i].Picture = Picture.Load(sPath)
          Endif

        Else
          With aObk[i]
            .Height = sHt * AppFactor
            .Left = 0
            .Width = (Panel1.Width - 75) * AppFactor
            .List = modLabTest.UniLabValueList($encid, $xParamVar[i]["Examination"])
            .Tag = i
          End With

        Endif

      Endif

    Endif
  Next

End

Private Function ChartHourVal() As Integer

  Dim xx As Integer

  If rboneday.Value = True Then
    xx = 24
  Else If rbtwoday.Value = True Then
    xx = 48
  Else If rbthreeday.Value = True Then
    xx = 72
  Else If rbweek.Value = True Then
    xx = 168
  Else
    xx = 0
  Endif

  Return xx

End

Public Sub SaveButton_Click()

  Dim i As Integer
  Dim xcateg As String

  i = Last.Tag

  If $sTitle = "Essential Examinations" Then
    xcateg = "Essential Examinations"
  Else
    xcateg = "Physician Examinations"
  Endif
  If aObVal[i] And If aObVal[i].Value Then
    modClinSub.AddQuantiData($encid, "", $xParamVar[i]["Examination"], "", aObVal[i].Value, False, xcateg, aObHBox[i].Tag)
    Balloon.Info(("Information saved"), aObButt[i])
    Balloon.Delay = modBasic.$BalloonDelay

  Else If aObBox[i] And If aObBox[i].Text Then
    modClinSub.AddQualiData($encid, "", $xParamVar[i]["Examination"], "", aObBox[i].Text, False, xcateg, aObHBox[i].Tag)
    Balloon.Info(("Information saved"), aObButt[i])
    Balloon.Delay = modBasic.$BalloonDelay

  Endif

End

' Private Sub LoadControls()
'
'   Dim i As Integer
'   Dim j As Integer
'   Dim sColl As Collection
'
'   If ListContainer1.Children.Count Then
'     ListContainer1.Children.Clear()
'   Endif
'
'   $labarr = New String[]
'   $examarr = New String[]
'   If $sTitle = "Essential Examinations" Then
'     $examarr = modString.GetListFromCompareVariant(modTableCache.$ExaminationCompVar, "fldexamid", "fldcategory", "Essential Examinations", True)
'   Else
'     For Each sColl In $xParamVar
'       If sColl["Category"] = "Examination" Then
'         $examarr.Add(sColl["Examination"])
'       Else If sColl["Category"] = "Laboratory" Then
'         $labarr.Add(sColl["Examination"])
'       Endif
'     Next
'   Endif
'
'   If $examarr Then
'     For i = 0 To $examarr.Count - 1
'       If i < 49 Then
'
'         aPanel[i] = New VBox(ListContainer1)
'         aObHBox[i] = New HBox(aPanel[i])
'         aObj1[i] = New TextLabel(aObHBox[i]) As "TextLabelGroup"
'         If modFixClinic.GetExaminationType($examarr[i]) = "Quantitative" Then
'           If $xalllow = True Then
'             aObVal[i] = New ValueBox(aObHBox[i])
'             aObButt[i] = New ToolButton(aObHBox[i]) As "SaveButton"
'             If $UserRestrict Then
'               If $UserRestrict.Exist("Essential Examinations") Then
'                 aObButt[i].Enabled = False
'               Endif
'             Endif
'           Endif
'
'           aObjx[i] = New ScrollView(aPanel[i]) As "ScrollGroup"
'           aObj[i] = New PictureBox(aObjx[i]) As "PictureBoxgroup"
'         Else
'           If $xalllow = True Then
'             aObBox[i] = New ComboBox(aObHBox[i])
'             aObButt[i] = New ToolButton(aObHBox[i]) As "SaveButton"
'             If $UserRestrict Then
'               If $UserRestrict.Exist("Essential Examinations") Then
'                 aObButt[i].Enabled = False
'               Endif
'             Endif
'           Endif
'
'           aObk[i] = New ListBox(aPanel[i]) As "ListGroup"
'         Endif
'
'       Endif
'     Next
'   Endif
'
'   If $labarr Then
'     For j = 0 To $labarr.Count - 1
'       If j < 49 Then
'
'         bPanel[i] = New VBox(ListContainer1)
'         bObj1[j] = New TextLabel(bPanel[i]) As "TextLabelGroup"
'         If modFixLab.GetLabTestType($labarr[j]) = "Quantitative" Then
'           bObjx[j] = New ScrollView(bPanel[i]) As "ScrollGroup"
'           bObj[j] = New PictureBox(bObjx[j]) As "PictureBoxgroup"
'         Else
'           bObk[j] = New ListBox(bPanel[i]) As "ListGroup"
'         Endif
'
'       Endif
'     Next
'   Endif
'   FillCHartItems(Slider1.Value * 10)
'
' End
'
' Private Sub FillCHartItems(sHt As Integer)
'
'   Dim i As Integer
'   Dim j As Integer
'   Dim sPath As String
'
'   $examColl = New Collection
'   $labColl = New Collection
'
'   ''examination
'   If $examarr Then
'     For i = 0 To $examarr.Count - 1
'       If i < 49 Then
'
'         With aPanel[i]
'           .Height = (30 + sHt) * AppFactor
'         End With
'
'         With aObHBox[i]
'           .Height = 30 * AppFactor
'           .Tag = modFixClinic.SysConstFromGetExamID($examarr[i])
'         End With
'
'         With aObj1[i]
'           .Left = 0
'           .Expand = True
'           .Height = 25 * AppFactor
'           .Top = 0
'           .Text = "<b>" & $examarr[i] & "</b>"
'           .Tag = i
'         End With
'
'         'get info and draw
'         If modFixClinic.GetExaminationType($examarr[i]) = "Quantitative" Then
'           If $xalllow = True Then
'             With aObVal[i]
'               .Left = 250 * AppFactor
'               .Width = 75 * AppFactor
'               .Height = 25 * AppFactor
'               .Top = 0
'               .Tag = i
'             End With
'             With aObButt[i]
'               .Left = 300 * AppFactor
'               .Width = 50 * AppFactor
'               .Height = 25 * AppFactor
'               .Top = 0
'               .Picture = Picture["icon:/small/apply"]
'               .Tag = i
'             End With
'           Endif
'
'           With aObjx[i]
'             .Height = sHt * AppFactor
'             .Left = 0
'             .Tag = i
'           End With
'           With aObj[i]
'             .Background = Color.White
'             .Expand = True
'             .AutoResize = True
'             .Height = (sHt - 20) * AppFactor
'             .Left = 0
'             .Top = 0
'             .Tag = i
'           End With
'           sPath = ""
'           If rballvisit.Value = True Then
'             sPath = modClinSub.FillQuantiExamChartHistory(aObj[i].Height, $encid, $PatientNum, $examarr[i], ChartHourVal())
'           Else
'             sPath = modClinSub.FillQuantiExamChart(aObj[i].Height, $encid, $examarr[i], ChartHourVal())
'           Endif
'           If sPath Then
'             Try aObj[i].Picture = Picture.Load(sPath)
'             $examColl.Add(sPath, $examarr[i])
'           Endif
'
'         Else
'           If $xalllow = True Then
'             With aObBox[i]
'               .Left = 250 * AppFactor
'               .Width = 150 * AppFactor
'               .Height = 25 * AppFactor
'               .Top = 0
'               .List = modAllExam.SelectExamOptionList("Exam", $examarr[i])
'               .Tag = i
'             End With
'             With aObButt[i]
'               .Left = 300 * AppFactor
'               .Width = 50 * AppFactor
'               .Height = 25 * AppFactor
'               .Top = 0
'               .Picture = Picture["icon:/small/apply"]
'               .Tag = i
'             End With
'           Endif
'
'           With aObk[i]
'             .Height = sHt * AppFactor
'             .Left = 0
'             .Width = (Panel1.Width - 75) * AppFactor
'             .List = modClinic.UniExamValueList($encid, $examarr[i])
'             .Tag = i
'           End With
'
'         Endif
'
'       Endif
'     Next
'   Endif
'
'   ''for lab tests
'   If $labarr Then
'     For j = 0 To $labarr.Count - 1
'       If j < 49 Then
'
'         With bPanel[i]
'           .Height = (30 + sHt) * AppFactor
'         End With
'
'         With bObj1[j]
'           .Left = 0
'           .Width = 300 * AppFactor
'           .Height = 25 * AppFactor
'           .Text = "<b>" & $labarr[j] & "</b>"
'           .Tag = j
'         End With
'
'         'get info and draw
'         If modFixLab.GetLabTestType($labarr[j]) = "Quantitative" Then
'           With bObjx[j]
'             .Height = sHt * AppFactor
'             .Left = 0
'             .Tag = j
'           End With
'           With bObj[j]
'             .Expand = True
'             .AutoResize = True
'             .Height = (sHt - 20) * AppFactor
'             .Left = 0
'             .Top = 0
'             .Tag = j
'           End With
'           sPath = ""
'           If rballvisit.Value = True Then
'             sPath = modLabSub.FillQuantiTestChartHistory(bObj[j].Height, $encid, $PatientNum, $labarr[j], $unt, ChartHourVal())
'           Else
'             sPath = modLabSub.FillQuantiTestChart(bObj[j].Height, $encid, $labarr[j], $unt, ChartHourVal())
'           Endif
'           If sPath Then
'             Try bObj[i].Picture = Picture.Load(sPath)
'             $labColl.Add(sPath, $labarr[j])
'           Endif
'
'         Else
'           With bObk[j]
'             .Height = sHt * AppFactor
'             .Left = 0
'             .Width = (Panel1.Width - 75) * AppFactor
'             .List = modLabTest.UniLabValueList($encid, $labarr[j])
'             .Tag = j
'           End With
'
'         Endif
'
'       Endif
'     Next
'   Endif
'
' End

Public Sub Form_Resize()

  ' ListContainer1.Left = 0
  ' ListContainer1.Top = 40 * AppFactor
  ' ListContainer1.Width = Panel1.Width - (50 * AppFactor)

End

Public Sub mnuexpo_Click()

End
