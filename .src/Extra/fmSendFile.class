' Gambas class file

Private $sFile As String

Public Sub _new(sPath As String)

  $sFile = sPath

End

Public Sub Form_Open()

  modGeneralMain.ArrangeFormCentre(Me, "False")
  If System.Exist("socat") = True Then
    btnsend.Enabled = True
  Else
    modApplSub.InstallSelectedApplication(["socat"])
  Endif
  btnfile.Text = File.Name($sFile)
  txtuser.SetFocus

End

Public Sub txtuser_Click()

  Dim xMedUser As String[]

  xMedUser = MedicalSelectedValue(("Select Target User"), modGeneral.FillCurrentUserNameonJob("%"))
  If xMedUser And If xMedUser.Count Then
    txtuser.Tag = xMedUser[0]
    txtuser.Text = xMedUser[1]
  Endif
  txtip.Text = modGeneral.GetCurrentIPFromUser(txtuser.Tag)

End

Public Sub btnfile_Click()

  modDevice.DesktopOpenFile($sFile)

End

Public Sub btnsend_Click()

  Dim hProc As Process

  If txtip.Text Then
    Inc Application.Busy
    modAppSupport.SendMessageTo(txtuser.Tag, txtip.Text, "Attachment", "", $sFile, False, False)
    If btnfile.Text Then
      If System.Exist("socat") Then
        hProc = Shell "socat -u FILE:" & $sFile & " TCP-LISTEN:" & modAppSupport.$ImagePort & ",reuseaddr"
      Else
        modApplSub.InstallSelectedApplication(["socat"])
      Endif
    Endif
    Dec Application.Busy
    Me.Close
  Endif

End
