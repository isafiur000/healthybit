' Gambas class file

Private $sFile As String
Private $xNew As Boolean

Public Sub _new(sFile As String)

  $sFile = sFile

End

Public Sub Form_Open()

  modGeneralMain.ArrangeFormCentre(Me, "False")
  txthost.Text = modBasic.$RepoManHost
  txtfolder.Text = modBasic.$RepoManFolder
  txtuser.Text = modBasic.$RepoManUser
  txtpassword.Text = modBasic.$RepoManPass
  If $sFile Then
    txtfile.Text = File.Name($sFile)
    $xNew = False
  Else
    $xNew = True
  Endif

End

Public Sub btnftp_Click()

  Dim xx As String
  Dim xfile As String

  If txthost.Text And If txtfolder.Text And If txtuser.Text Then
    If $xNew = True Then
      If File.Ext($sFile) Then
        xfile = File.Name($sFile) & "." & File.Ext($sFile)
      Else
        xfile = File.Name($sFile)
      Endif
    Else
      If File.Ext($sFile) Then
        xfile = modString.GetNowString() & "." & File.Ext($sFile)
      Else
        xfile = modString.GetNowString()
      Endif
    Endif
    Inc Application.Busy
    xx = modDevAll.SendFileToFTP(txthost.Text, txtfolder.Text, txtuser.Text, txtpassword.Text, xfile, $sFile)
    Dec Application.Busy
    If xx Then
      Message.Warning(xx, ("OK"))
    Endif
  Endif
  Me.Close

End

Public Sub txtfile_Click()

  If $sFile Then
    modDevice.DesktopOpenFile($sFile)
  Else
    If Dialog.OpenFile() Then Return
    txtfile.Text = Dialog.Path
    $sFile = txtfile.Text
  Endif

End

Public Sub txtfolder_KeyPress()

  modGeneralMain.InputTextKeyOnly()

End
