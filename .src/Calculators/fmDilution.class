' Gambas class file

Public Sub Form_Open()

  modGeneralMain.ArrangeFormCentre(Me)
  'electrolyte
  cmbunit.Add("mg")
  cmbunit.Add("mEq")
  cmbunit.Add("mMol")

End

Public Sub Form_Close()

  modGeneralMain.RecordFormExit(Me)

End

Public Sub Form_KeyRelease()

  modGeneralmain.GoToNextControlTab()

End

''----------------------------------------------- ELECTROLYTE ------------------------------------------------------------
Public Sub cmbelectro_GotFocus()

  Dim res As Result

  res = modDatabase.$myConn.Exec("select distinct(fldcategory) as col from tblelectrolyte")
  cmbelectro.List = modControlSub.GetDirectFillresult(res)

End

Public Sub cmbsalt_GotFocus()

  Dim res As Result

  res = modDatabase.$myConn.Exec("select fldsalt as col from tblelectrolyte where fldcategory=&1", cmbelectro.Text)
  cmbsalt.List = modControlSub.GetDirectFillresult(res)

End

Public Sub cmbelectro_KeyRelease()

  modFillContainer.AutoFillComboBox(cmbelectro)
  modFillContainer.RestrictComboToContent(cmbelectro)

End

Public Sub cmbunit_KeyRelease()

  modFillContainer.AutoFillComboBox(cmbunit)
  modFillContainer.RestrictComboToContent(cmbunit)

End

Public Sub cmbsalt_KeyRelease()

  modFillContainer.AutoFillComboBox(cmbsalt)
  modFillContainer.RestrictComboToContent(cmbsalt)

End

Public Sub cmbelectro_LostFocus()

  If cmbelectro.Text = "Bicarbonate" Then
    Balloon.Info(("1 mEq of bicarbonate has same alkalinizing power as 1 mEq of acetate"), cmbelectro)
    Balloon.Delay = modBasic.$BalloonDelay
  Else If cmbelectro.Text = "Acetate" Then
    Balloon.Info(("1 mEq of acetate has same alkalinizing power as 1 mEq of bicarbonate"), cmbelectro)
    Balloon.Delay = modBasic.$BalloonDelay
  Endif

End

Public Sub btncalc1_Click()

  Dim res As Result

  If cmbsalt.Text And If cmbunit.Text And If txtdose.Value Then

    res = modDatabase.$myConn.Exec("select fldmg,fldmmol,fldmeq from tblelectrolyte where fldcategory=&1 and fldsalt=&2", cmbelectro.Text, cmbsalt.Text)                                                       ''
    If res.Available = True Then
      If cmbunit.Text = "mg" Then
        If res!fldmg > 0 Then
          txtsaltgram.Value = Round(txtdose.Value / res!fldmg, -3)
        Endif
      Else If cmbunit.Text = "mMol" Then
        If res!fldmmol > 0 Then
          txtsaltgram.Value = Round(txtdose.Value / res!fldmmol, -3)
        Endif
      Else If cmbunit.Text = "mEq" Then
        If res!fldmeq > 0 Then
          txtsaltgram.Value = Round(txtdose.Value / res!fldmeq, -3)
        Endif
      Endif
    Endif
  Endif

End

Public Sub btncalc2_Click()

  If txtsolper.Value Then
    txtsolvol.Value = Round(txtsaltgram.Value * 100 / txtsolper.Value, -3)
  Endif

End

Public Sub cmbunit_LostFocus()

  cmbsalt.SetFocus

End
