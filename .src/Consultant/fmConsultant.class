' Gambas class file

Public Sub Form_Arrange()

  modAppSupport.SetWorkSpaceImage()

End

Public Sub Form_Open()

  modGeneralMain.GetFirstValues(ServerSocket1, ServerSocket2)
  modGeneralMain.LoadMainForms(Me, pnltop, pnlleft, Workspace1, pnlright, pnlbottom)

  DiaplayCustMenu()
  modBasic.LoadClinicalChartSetting()
  modBasic.LoadClinicalLists()
  modBasic.ClinicalCommentSett()
  modBasic.LoadRegistrationSetting()
  modBasic.SetClinicalProcedures()
  modBasic.LoadLabRadioList()

  modBasic.SetAccountRules()
  modBasic.ChartSettingsAll()

  modLinkDB.LoadExtraDBSettings()

  modBasic.$ClinDietApprove = modGlobalSetting.ShowSettingFromDB("ClinicForms/User_DietApproval")
  modAMISRep.$AyurvedicDiagnosis = modHelpVariable.$docsDirectory &/ "ayurvedicdisease.csv"

End

Public Sub Form_Close()

  modGeneralMain.ExitAllWindows()

End

''---------------------------------------- CustomAccount Reports -------------------------------------
Private Sub DiaplayCustMenu()

  If modSettings.ShowSettingForReport("Consultant.CustomQuery1/Name") Then
    mnucust1.Caption = modSettings.ShowSettingForReport("Consultant.CustomQuery1/Name")
    mnucust1.Tag = "Consultant.CustomQuery1"
    mnucust1.Enabled = True
  Endif

  If modSettings.ShowSettingForReport("Consultant.CustomQuery2/Name") Then
    mnucust2.Caption = modSettings.ShowSettingForReport("Consultant.CustomQuery2/Name")
    mnucust2.Tag = "Consultant.CustomQuery2"
    mnucust2.Enabled = True
  Endif

  If modSettings.ShowSettingForReport("Consultant.CustomQuery3/Name") Then
    mnucust3.Caption = modSettings.ShowSettingForReport("Consultant.CustomQuery3/Name")
    mnucust3.Tag = "Consultant.CustomQuery3"
    mnucust3.Enabled = True
  Endif

  If modSettings.ShowSettingForReport("Consultant.CustomQuery4/Name") Then
    mnucust4.Caption = modSettings.ShowSettingForReport("Consultant.CustomQuery4/Name")
    mnucust4.Tag = "Consultant.CustomQuery4"
    mnucust4.Enabled = True
  Endif

  If modSettings.ShowSettingForReport("Consultant.CustomQuery5/Name") Then
    mnucust5.Caption = modSettings.ShowSettingForReport("Consultant.CustomQuery5/Name")
    mnucust5.Tag = "Consultant.CustomQuery5"
    mnucust5.Enabled = True
  Endif

End

Public Sub mnucust1_Click()

  Dim hForm As FmCustQueryTable

  hForm = New FmCustQueryTable(modDatabase.$syConn, mnucust1.Tag)
  modWorkSpace.Add(hForm)

End

Public Sub mnucust2_Click()

  Dim hForm As FmCustQueryTable

  hForm = New FmCustQueryTable(modDatabase.$syConn, mnucust2.Tag)
  modWorkSpace.Add(hForm)

End

Public Sub mnucust3_Click()

  Dim hForm As FmCustQueryTable

  hForm = New FmCustQueryTable(modDatabase.$syConn, mnucust3.Tag)
  modWorkSpace.Add(hForm)

End

Public Sub mnucust4_Click()

  Dim hForm As FmCustQueryTable

  hForm = New FmCustQueryTable(modDatabase.$syConn, mnucust4.Tag)
  modWorkSpace.Add(hForm)

End

Public Sub mnucust5_Click()

  Dim hForm As FmCustQueryTable

  hForm = New FmCustQueryTable(modDatabase.$syConn, mnucust5.Tag)
  modWorkSpace.Add(hForm)

End

''=========================== Others ================================
Public Sub mnuscreen_Click()

  If Dialog.SelectDirectory() Then Return
  Wait 2
  Desktop.Screenshot().Save(Dialog.Path &/ modString.GetNowString() & ".png")
  Message.Info(("Screen Shot saved in ") & Dialog.Path, ("OK"))

End

Public Sub mnuplaymedia_Click()

  modAppSupport.PlayMediaFile()

End

Public Sub mnureferlocat_Click()

  Dim hForm As FmAddVarTwo
  Dim xx As String[]
  Dim yy As String[]

  xx = New String[]
  yy = New String[]
  hForm = New FmAddVarTwo("fldlocation", "fldcode", "tblreferlist", xx, yy)
  hForm.ShowModal

End

Public Sub mnuexit_Click()

  modGeneralMain.CloseAllWindows()

End

Public Sub mnupersonal_Click()

  modWorkSpace.Remove(fmPersonal)
  modWorkSpace.Add(fmPersonal)

End

Public Sub mnumail_Click()

  fmMail.Close
  fmMail.ShowModal

End

Public Sub mnuappset_Click()

  fmAppSetting.Close
  fmAppSetting.ShowModal

End

Public Sub mnuseract_Click()

  fmAppUser.Close
  fmAppUser.ShowModal

End

Public Sub mnulock_Click()

  fmLock.Close
  fmLock.ShowModal

End

Public Sub mnuclinsett_Click()

  fmMedSetting.Close
  fmMedSetting.ShowModal

End

Public Sub mnuformedicine_Click()

  Dim hForm As FmFormulary

  If modSettings.ShowSettingFromFIle("Formulary/Medicine_Source") = "Internet" Then
    If Desktop.NetworkAvailable = True Then
      If Not modWeb.$webMedConn Then
        modWeb.ConnectRemoteMedServer()
      Endif
      hForm = New FmFormulary(modWeb.$webMedConn)
      hForm.ShowModal
    Endif
  Else
    hForm = New FmFormulary(modDatabase.$syConn)
    hForm.ShowModal
  Endif

End

Public Sub mnuformpatho_Click()

  Dim hForm As FmPathoFormulary

  If modSettings.ShowSettingFromFIle("Formulary/Pathology_Source") = "Internet" Then
    If Desktop.NetworkAvailable = True Then
      If Not modWeb.$webMedConn Then
        modWeb.ConnectRemoteMedServer()
      Endif
      hForm = New FmPathoFormulary(modWeb.$webMedConn)
      hForm.ShowModal
    Endif
  Else
    hForm = New FmPathoFormulary(modDatabase.$syConn)
    hForm.ShowModal
  Endif

End

Public Sub mnuformdiagno_Click()

  Dim hForm As FmDiagnoFormulary

  If modSettings.ShowSettingFromFIle("Formulary/Diagnostic_Source") = "Internet" Then
    If Desktop.NetworkAvailable = True Then
      If Not modWeb.$webMedConn Then
        modWeb.ConnectRemoteMedServer()
      Endif
      hForm = New FmDiagnoFormulary(modWeb.$webMedConn)
      hForm.ShowModal
    Endif
  Else
    hForm = New FmDiagnoFormulary(modDatabase.$syConn)
    hForm.ShowModal
  Endif

End

Public Sub ServerSocket1_Connection(RemoteHostIP As String)

  Dim hForm As FmChat

  If ServerSocket1.Status <= Net.Inactive Then Return
  hForm = New FmChat(modBasic.$lbluser, RemoteHostIP, "acc")
  hForm.Show

End

'''---------------------- transfer server -------------------------------------------------------
Public Sub ServerSocket2_Connection(RemoteHostIP As String)

  Dim Myket As Socket

  Myket = ServerSocket2.Accept()
  Myket.Blocking = False
  Print RemoteHostIP

End

Public Sub Socket_Read()

  Dim sCad As String

  If Last.Status <> Net.Connected Then Return
  Read #Last, sCad, Lof(Last)
  modControl.ShowTransferFile(Last.RemoteHost, sCad)

End

Public Sub Workspace1_Menu()

  If Workspace1.Windows.Count = 0 Then
    mnufile.Popup
  Endif

End

Public Sub mnubackground_Click()

  Dialog.Filter = ["*.jpg;*.jpeg;*.png;*.bmp", "Picture files"]
  If Dialog.OpenFile() Then Return
  modSettings.SaveSettingsToVar("AppSetting_DeskPicture/" & modBasic.$lbluser, Dialog.Path)
  modAppSupport.SetWorkSpaceImage()

End

Public Sub mnunewextra_Click()

  modWeb.ExecGeneralSub()

End

Public Sub mnubedocc_Click()

  modWorkSpace.Remove(fmClinBedList)
  modWorkSpace.Add(fmClinBedList)

End

Public Sub Menu9_Click()

  modWorkSpace.Remove(fmSummryReport)
  modWorkSpace.Add(fmSummryReport)

End

Public Sub mnuprinter_Click()

  fmPrinterSettings.Close
  fmPrinterSettings.ShowModal

End

Public Sub mnuessen_Click()

  fmvitalexam.Close
  fmvitalexam.ShowModal

End

Public Sub mnuexamgroup_Click()

  fmExamGroup.Close
  fmExamGroup.ShowModal

End

Public Sub mnudietpack_Click()

  Dim hForm As FmServGroup

  hForm = New FmServGroup("Diet Packages", "")
  hForm.ShowModal

End

Public Sub mnuprocgroup_Click()

  Dim hForm As FmAddVarTwo
  Dim xx As String[]
  Dim yy As String[]

  xx = modNonMedical.NonStockBillActiveItemArray("Procedures", "%", "Extra")
  yy = modControlSub.GetDirectFillresult(modDatabase.$myConn.Exec("select fldprocname as col from tblprocname"))
  hForm = New FmAddVarTwo("fldgroupname", "fldprocname", "tblgroupproc", xx, yy)
  hForm.ShowModal

End

Public Sub mnuselitemlist_Click()

  fmcostGroup.Close
  fmcostGroup.ShowModal

End

Public Sub mnudeptexam_Click()

  fmDiffExam.Close
  fmDiffExam.ShowModal

End

Public Sub mnutriage_Click()

  fmTriageSetting.Close
  fmTriageSetting.ShowModal()

End

Public Sub mnudemograph_Click()

  fmDemographic.Close
  fmDemographic.ShowModal

End

Public Sub mnubilprtset_Click()

  fmReportSetting.Close
  fmReportSetting.ShowModal

End

Public Sub mnuwebcam_Click()

  fmDeviceSetting.Close
  fmDeviceSetting.ShowModal

End

Public Sub mnuchartset_Click()

  fmChartSetting.Close
  fmChartSetting.ShowModal

End

Public Sub mnuembedder_Click()

  modExternal.RunExternalFixScript()

End

Public Sub mnuremoaccess_Click()

  fmStreaming.Close
  fmStreaming.ShowModal

End

Public Sub mnutranslate_Click()

  Dim hForm As FmTranslate

  hForm = New FmTranslate("Translate", Clipboard.Paste())
  hForm.ShowModal

End

Public Sub mnupathosett_Click()

  fmPathoSetting.Close
  fmPathoSetting.ShowModal

End

Public Sub mnusearrepo_Click()

  fmCheckFile.Close
  fmCheckFile.ShowModal()

End

Public Sub mnuposting_Click()

  fmQuotaPrescriber.Close
  fmQuotaPrescriber.ShowModal

End

Public Sub mnunotice_Click()

  fmCompNotice.Close
  fmCompNotice.ShowModal

End

Public Sub mnuaptname_Click()

  txtpatno.Text = PatSearch("PatientNo")

End

Public Sub mnutrans_Click()

  modWorkSpace.Remove(fmBedReport)
  modWorkSpace.Add(fmBedReport)

End

Public Sub mnucustsetting_Click()

  fmCusAccReport.Close
  fmCusAccReport.ShowModal

End

Public Sub mnuclrcache_Click()

  modGeneralMain.CLearUserCollection()

End

Public Sub mnualgorithm_Click()

  fmCustomPaths.Close
  fmCustomPaths.ShowModal

End

Public Sub mnudeptsetting_Click()

  fmClinicSetting.Close
  fmClinicSetting.ShowModal

End

Public Sub Menu3_Click()

  fmCustAllReport.Close
  fmCustAllReport.ShowModal

End

Public Sub mnuperformance_Click()

  modWorkSpace.Remove(fmPerformance)
  modWorkSpace.Add(fmPerformance)

End

Public Sub mnupatreposett_Click()

  fmCustomReport.Close
  fmCustomReport.ShowModal

End

Public Sub mnusaved_Click()

  Dim hForm As FmPatReports

  hForm = New FmPatReports("")
  modWorkSpace.Add(hForm)

End

Public Sub mnuipdates_Click()

  modWorkSpace.Remove(fmClinSummary)
  modWorkSpace.Add(fmClinSummary)

End

Public Sub mnuclinaccess_Click()

  fmClinUserAccess.Close
  fmClinUserAccess.ShowModal

End

Public Sub mnuresearch_Click()

  modWorkSpace.Remove(fmResearchCode)
  modWorkSpace.Add(fmResearchCode)

End

Public Sub mnuscript_Click()

  fmScriptWrite.Close
  fmScriptWrite.ShowModal

End

Public Sub mnubrowser_Click()

  Dim xURL As String
  Dim hForm As FmWebView

  xURL = modSettings.ShowSettingFromFIle("GeneralSettings/Browser_URL")
  If xURL Then
    hForm = New FmWebView(xURL)
    modWorkSpace.Add(hForm)
  Endif

End

Public Sub mnuseleupload_Click()

  fmSelLabReport.Close
  fmSelLabReport.ShowModal

End

Public Sub mnuewars_Click()

  fmSelEwars.Close
  fmSelEwars.ShowModal

End

Public Sub mnudietapprove_Click()

  modWorkSpace.Remove(fmDietApprove)
  modWorkSpace.Add(fmDietApprove)

End

Public Sub mnustudysample_Click()

  modWorkSpace.Remove(fmStudySample)
  modWorkSpace.Add(fmStudySample)

End

Public Sub mnupastdocs_Click()

  fmUploadMulti.Close
  fmUploadMulti.ShowModal

End

Public Sub mnuuploadpat_Click()

  fmSelPatReport.Close
  fmSelPatReport.ShowModal

End

Public Sub mnugodebug_Click()

  If mnugodebug.Caption = "Debug On" Then
    mnugodebug.Caption = "Debug Off"
    modBasic.$DebugMode = True
    modBasic.$DebugDB = True
    db.Debug = True

  Else If mnugodebug.Caption = "Debug Off" Then
    mnugodebug.Caption = "Debug On"
    modBasic.$DebugMode = False
    modBasic.$DebugDB = False
    db.Debug = False

  Endif

End

Public Sub mnubugreport_Click()

  modGeneralMain.SendBugReport(modBasic.$lbluser)

End

Public Sub mnuregimen_Click()

  fmMedRegimen.Close
  fmMedRegimen.ShowModal

End
