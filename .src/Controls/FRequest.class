' Gambas class file

Private $rData As Result
Private $aMyFields As String[]
Private $strType As String
Private $strTitle As String

Public Sub _new(res As Result, strTitle As String, strType As String, AllowExport As Boolean)

  $strType = strType
  $rData = res
  $strTitle = strTitle

  Me.Title = $strTitle
  mnutransfer.Visible = AllowExport

End

Public Sub Form_Open()

  modGeneralMain.ArrangeFormCentre(Me, "False")
  If $strType = "PatientEncounters" Then
    mnuimages.Visible = True
    mnubill.Visible = True
    Select MMain.$SISHAppMode
      Case "REP", "HMIS3.6"
        mnumovement.Visible = True
      Case Else
        mnumovement.Visible = False
    End Select
  Else If $strType = "PatientRemoteEncounters" Then
    mnuimages.Visible = True
    mnubill.Visible = True
    mnumovement.Visible = True
  Else If $strType = "ArchivedReports" Then
    mnudoreport.Visible = True
  Else If $strType = "ArchivedRepoReports" Then
    mnudoreport.Visible = True
  Endif
  ShowGridView()

End

Private Sub ShowGridView()

  $aMyFields = New String[]
  modGridView.ReadSmallData(GridView1, $rData, $aMyFields)
  ResizeGridView()

End

Public Sub GridView1_Data(Row As Integer, Column As Integer)

  $rData.MoveTo(Row)
  modGeneralMain.GridViewDecoration(GridView1, Row)

  If $strType = "YearReport" Then
    If Column = 4 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.MediumDate)
    Else If Column = 13 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.MediumTime)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "TransactionActivity" Then
    If Column = 0 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "StockDB" Then
    If Column = 3 Then
      If $rData[$aMyFields[Column]] <= Now() Then
        GridView1.Data.Foreground = modBasic.$HighLightColor
      Endif
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData["fldexpiry"], gb.MediumDate)
    Else If Column = 4 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 5 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "MedList" Then
    If Column = 1 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData["fldtime"], gb.GeneralDate)
    Else If Column = 3 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 4 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "PatientSearch" Then
    If Column = 2 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData["fldregdate"], gb.GeneralDate)
    Else If Column = 4 Then
      GridView1.Data.Text = modGeneral.GetUserFullName($rData[$aMyFields[Column]])
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Billing:SelectedInvoice" Then
    If Column = 2 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 3 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 4 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 5 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 6 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 7 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData["fldtime"], gb.GeneralDate)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "PatientEncounters" Then
    If Column = 1 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 4 Then
      GridView1.Data.Text = modGeneral.GetUserFullName($rData[$aMyFields[Column]])
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "PatientRemoteEncounters" Then
    If Column = 1 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 4 Then
      GridView1.Data.Text = modGeneral.GetUserFullName($rData[$aMyFields[Column]])
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "AccGroup:Duplicates" Then
    If Column = 2 Then
      GridView1.Data.Text = modNonMedical.GetReportGroupName($rData[$aMyFields[Column]])
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Transaction:Purchase" Then
    If Column = 3 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 4 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 5 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 6 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 7 Then
      Try GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 12 Then
      GridView1.Data.Text = modDataRepo.GetHospitalTextLabel($rData[$aMyFields[Column]])
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Transaction:Consume" Then
    If Column = 3 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 4 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 5 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 6 Then
      Try GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 10 Then
      GridView1.Data.Text = modDataRepo.GetHospitalTextLabel($rData[$aMyFields[Column]])
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Transaction:Dispensed" Then
    If Column = 1 Then
      GridView1.Data.Text = modPatient.GetPatientNameByEnc($rData[$aMyFields[Column]], modDatabase.$syConn)
    Else If Column = 3 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 4 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 5 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 6 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], -2)
    Else If Column = 7 Then
      GridView1.Data.Text = modReportVar.GetLocaleNumberFormat($rData[$aMyFields[Column]], gb.Currency)
    Else If Column = 8 Then
      Try GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 10 Then
      GridView1.Data.Text = modStock.GetStockNameFromStockno($rData[$aMyFields[Column]])
    Else If Column = 14 Then
      GridView1.Data.Text = modDataRepo.GetHospitalTextLabel($rData[$aMyFields[Column]])
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Invoice/Receipt"
    If Column = 0 Then
      Try GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "ArchivedReports" Then
    If Column = 1 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "ArchivedRepoReports" Then
    If Column = 1 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 9 Then
      GridView1.Data.Picture = Picture["icon:/small/attach"]
      GridView1.Data.Text = ""
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "Pharmacy:Cancelled" Then
    If Column = 1 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else If Column = 12 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.GeneralDate)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else If $strType = "PurchaseReference" Then
    If Column = 0 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport($rData[$aMyFields[Column]], gb.MediumDate)
    Else If Column = 3 Then
      GridView1.Data.Text = modStock.GetBatchFromStockNo($rData[$aMyFields[Column]])
    Else If Column = 4 Then
      GridView1.Data.Text = modReportVar.GetDateTimeReport(modStock.GetExpiryFromStockNo($rData[$aMyFields[Column]]), gb.MediumDate)
    Else
      GridView1.Data.Text = $rData[$aMyFields[Column]]
    Endif

  Else
    GridView1.Data.Text = $rData[$aMyFields[Column]]
  Endif
  GridView1.Rows[Row].Height = Max(GridView1.Rows[Row].Height, GridView1.Data.Font.RichTextHeight(GridView1.Data.Text, GridView1.Columns[Column].Width - 5 * modBasic.$AppWidthRatio) + (GridView1.Rows.Height - GridView1.Font.Height))
  GridView1.Data.WordWrap = True

End

Private Sub ResizeGridView()

  With GridView1

    If $strType = "YearReport" Then
      .Columns[0].Width = 75 * modBasic.$AppWidthRatio
      .Columns[1].Width = 120 * modBasic.$AppWidthRatio
      .Columns[2].Width = 150 * modBasic.$AppWidthRatio
      .Columns[3].Width = 100 * modBasic.$AppWidthRatio
      .Columns[4].Width = 120 * modBasic.$AppWidthRatio
      .Columns[5].Width = 100 * modBasic.$AppWidthRatio
      .Columns[6].Width = 100 * modBasic.$AppWidthRatio
      .Columns[7].Width = 100 * modBasic.$AppWidthRatio
      .Columns[8].Width = 100 * modBasic.$AppWidthRatio
      .Columns[9].Width = 100 * modBasic.$AppWidthRatio
      .Columns[10].Width = 75 * modBasic.$AppWidthRatio
      .Columns[11].Width = 75 * modBasic.$AppWidthRatio
      .Columns[12].Width = 75 * modBasic.$AppWidthRatio
      .Columns[13].Width = 100 * modBasic.$AppWidthRatio
      .Columns[14].Width = 100 * modBasic.$AppWidthRatio
      .Columns[15].Width = 100 * modBasic.$AppWidthRatio
      .Columns[16].Width = 75 * modBasic.$AppWidthRatio

      .Columns[0].Text = "Year"
      .Columns[1].Text = "Invoice"
      .Columns[2].Text = "Name"
      .Columns[3].Text = "PAN"
      .Columns[4].Text = "Date"
      .Columns[5].Text = "ItemAMT"
      .Columns[6].Text = "DiscAMT"
      .Columns[7].Text = "TaxableAMT"
      .Columns[8].Text = "TaxAMT"
      .Columns[9].Text = "TotalAMT"
      .Columns[10].Text = "Synced"
      .Columns[11].Text = "IsPrinted"
      .Columns[12].Text = "IsActive"
      .Columns[13].Text = "Time"
      .Columns[14].Text = "PunchedBy"
      .Columns[15].Text = "PrintedBy"
      .Columns[16].Text = "RealTime"

    Else If $strType = "TransactionActivity" Then
      .Columns[0].Width = 150 * modBasic.$AppWidthRatio
      .Columns[1].Width = 150 * modBasic.$AppWidthRatio
      .Columns[2].Width = 100 * modBasic.$AppWidthRatio
      .Columns[3].Width = 150 * modBasic.$AppWidthRatio
      .Columns[4].Width = 150 * modBasic.$AppWidthRatio
      .Columns[5].Width = 100 * modBasic.$AppWidthRatio

      .Columns[0].Text = "DateTime"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "FormName"
      .Columns[3].Text = "Activity"
      .Columns[4].Text = "Comment"
      .Columns[5].Text = "User"

    Else If $strType = "StockDB" Then
      .Columns[0].Width = 50 * modBasic.$AppWidthRatio
      .Columns[1].Width = 275 * modBasic.$AppWidthRatio
      .Columns[2].Width = 100 * modBasic.$AppWidthRatio
      .Columns[3].Width = 125 * modBasic.$AppWidthRatio
      .Columns[4].Width = 50 * modBasic.$AppWidthRatio
      .Columns[5].Width = 75 * modBasic.$AppWidthRatio
      .Columns[6].Width = 50 * modBasic.$AppWidthRatio
      .Columns[7].Width = 75 * modBasic.$AppWidthRatio

      .Columns[0].Text = "No"
      .Columns[1].Text = "Particular"
      .Columns[2].Text = "Batch"
      .Columns[3].Text = "Expiry"
      .Columns[4].Text = "QTY"
      .Columns[5].Text = "SellP"
      .Columns[6].Text = "Order"
      .Columns[7].Text = "Comp"

    Else If $strType = "MedList" Then
      .Columns[0].Width = 75 * modBasic.$AppWidthRatio
      .Columns[1].Width = 180 * modBasic.$AppWidthRatio
      .Columns[2].Width = 420 * modBasic.$AppWidthRatio
      .Columns[3].Width = 100 * modBasic.$AppWidthRatio
      .Columns[4].Width = 100 * modBasic.$AppWidthRatio

      .Columns[0].Text = "No"
      .Columns[1].Text = "Date"
      .Columns[2].Text = "Particular"
      .Columns[3].Text = "Sale QTY"
      .Columns[4].Text = "Ret QTY"

    Else If $strType = "PatientSearch" Then
      .Columns[0].Width = 125 * modBasic.$AppWidthRatio
      .Columns[1].Width = 150 * modBasic.$AppWidthRatio
      .Columns[2].Width = 180 * modBasic.$AppWidthRatio
      .Columns[3].Width = 100 * modBasic.$AppWidthRatio
      .Columns[4].Width = 150 * modBasic.$AppWidthRatio

      .Columns[0].Text = "Encounter"
      .Columns[1].Text = "Registration"
      .Columns[2].Text = "DORec"
      .Columns[3].Text = "Status"
      .Columns[4].Text = "Consult"

    Else If $strType = "Billing:SelectedInvoice" Then
      .Columns[0].Width = 125 * modBasic.$AppWidthRatio
      .Columns[1].Width = 275 * modBasic.$AppWidthRatio
      .Columns[2].Width = 100 * modBasic.$AppWidthRatio
      .Columns[3].Width = 50 * modBasic.$AppWidthRatio
      .Columns[4].Width = 50 * modBasic.$AppWidthRatio
      .Columns[5].Width = 50 * modBasic.$AppWidthRatio
      .Columns[6].Width = 125 * modBasic.$AppWidthRatio
      .Columns[7].Width = 150 * modBasic.$AppWidthRatio
      .Columns[8].Width = 1
      .Columns[9].Width = 125 * modBasic.$AppWidthRatio

      .Columns[0].Text = "EncID"
      .Columns[1].Text = "Particulars"
      .Columns[2].Text = "Rate"
      .Columns[3].Text = "QTY"
      .Columns[4].Text = "Tax%"
      .Columns[5].Text = "Disc%"
      .Columns[6].Text = "Total"
      .Columns[7].Text = "EntryDate"
      .Columns[9].Text = "Invoice"

    Else If $strType = "AccGroup:Missing" Or If $strType = "AccGroup:Deleted" Or If $strType = "ItemGroup:Missing" Then
      .Columns[0].Width = 400 * modBasic.$AppWidthRatio
      .Columns[1].Width = 200 * modBasic.$AppWidthRatio
      .Columns[2].Width = 100 * modBasic.$AppWidthRatio

      .Columns[0].Text = "Particulars"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "Rate"

    Else If $strType = "AccGroup:Duplicates" Then
      .Columns[0].Width = 350 * modBasic.$AppWidthRatio
      .Columns[1].Width = 200 * modBasic.$AppWidthRatio
      .Columns[2].Width = 150 * modBasic.$AppWidthRatio
      .Columns[3].Width = 75 * modBasic.$AppWidthRatio

      .Columns[0].Text = "Particulars"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "Category"
      .Columns[3].Text = "Count"

    Else If $strType = "PatientEncounters" Then
      .Columns[0].Width = 125 * modBasic.$AppWidthRatio
      .Columns[1].Width = 150 * modBasic.$AppWidthRatio
      .Columns[2].Width = 100 * modBasic.$AppWidthRatio
      .Columns[3].Width = 125 * modBasic.$AppWidthRatio
      .Columns[4].Width = 175 * modBasic.$AppWidthRatio
      .Columns[5].Width = 150 * modBasic.$AppWidthRatio

      .Columns[0].Text = "Encounter"
      .Columns[1].Text = "DORec"
      .Columns[2].Text = "Status"
      .Columns[3].Text = "LastLocat"
      .Columns[4].Text = "Consultant"
      .Columns[5].Text = "Package"

    Else If $strType = "PatientRemoteEncounters" Then
      .Columns[0].Width = 125 * modBasic.$AppWidthRatio
      .Columns[1].Width = 150 * modBasic.$AppWidthRatio
      .Columns[2].Width = 100 * modBasic.$AppWidthRatio
      .Columns[3].Width = 125 * modBasic.$AppWidthRatio
      .Columns[4].Width = 175 * modBasic.$AppWidthRatio
      .Columns[5].Width = 150 * modBasic.$AppWidthRatio

      .Columns[0].Text = "Encounter"
      .Columns[1].Text = "DORec"
      .Columns[2].Text = "Status"
      .Columns[3].Text = "LastLocat"
      .Columns[4].Text = "Consultant"
      .Columns[5].Text = "Hospital"

    Else If $strType = "Transaction:Purchase" Then
      .Columns[0].Width = 200 * modBasic.$AppWidthRatio
      .Columns[1].Width = 100 * modBasic.$AppWidthRatio
      .Columns[2].Width = 275 * modBasic.$AppWidthRatio
      .Columns[3].Width = 75 * modBasic.$AppWidthRatio
      .Columns[4].Width = 75 * modBasic.$AppWidthRatio
      .Columns[5].Width = 50 * modBasic.$AppWidthRatio
      .Columns[6].Width = 100 * modBasic.$AppWidthRatio
      .Columns[7].Width = 150 * modBasic.$AppWidthRatio
      .Columns[8].Width = 125 * modBasic.$AppWidthRatio
      .Columns[9].Width = 125 * modBasic.$AppWidthRatio
      .Columns[10].Width = 75 * modBasic.$AppWidthRatio
      .Columns[11].Width = 1

      .Columns[0].Text = "Supplier"
      .Columns[1].Text = "Payment"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "SupRate"
      .Columns[4].Text = "NetRate"
      .Columns[5].Text = "QTY"
      .Columns[6].Text = "Total"
      .Columns[7].Text = "DateTime"
      .Columns[8].Text = "Invoice"
      .Columns[9].Text = "Reference"
      .Columns[10].Text = "CompID"

    Else If $strType = "Transaction:Consume" Then
      .Columns[0].Width = 125 * modBasic.$AppWidthRatio
      .Columns[1].Width = 100 * modBasic.$AppWidthRatio
      .Columns[2].Width = 275 * modBasic.$AppWidthRatio
      .Columns[3].Width = 75 * modBasic.$AppWidthRatio
      .Columns[4].Width = 50 * modBasic.$AppWidthRatio
      .Columns[5].Width = 100 * modBasic.$AppWidthRatio
      .Columns[6].Width = 150 * modBasic.$AppWidthRatio
      .Columns[7].Width = 125 * modBasic.$AppWidthRatio
      .Columns[8].Width = 75 * modBasic.$AppWidthRatio
      .Columns[9].Width = 1

      .Columns[0].Text = "Target"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "Rate"
      .Columns[4].Text = "QTY"
      .Columns[5].Text = "Total"
      .Columns[6].Text = "DateTime"
      .Columns[7].Text = "Reference"
      .Columns[8].Text = "CompID"

    Else If $strType = "Transaction:Dispensed" Then
      .Columns[0].Width = 100 * modBasic.$AppWidthRatio
      .Columns[1].Width = 175 * modBasic.$AppWidthRatio
      .Columns[2].Width = 275 * modBasic.$AppWidthRatio
      .Columns[3].Width = 75 * modBasic.$AppWidthRatio
      .Columns[4].Width = 50 * modBasic.$AppWidthRatio
      .Columns[5].Width = 50 * modBasic.$AppWidthRatio
      .Columns[6].Width = 50 * modBasic.$AppWidthRatio
      .Columns[7].Width = 100 * modBasic.$AppWidthRatio
      .Columns[8].Width = 150 * modBasic.$AppWidthRatio
      .Columns[9].Width = 125 * modBasic.$AppWidthRatio
      .Columns[10].Width = 300 * modBasic.$AppWidthRatio
      .Columns[11].Width = 75 * modBasic.$AppWidthRatio
      .Columns[12].Width = 75 * modBasic.$AppWidthRatio
      .Columns[13].Width = 1

      .Columns[0].Text = "Encounter"
      .Columns[1].Text = "Patient Name"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "Rate"
      .Columns[4].Text = "QTY"
      .Columns[5].Text = "Disc%"
      .Columns[6].Text = "Tax%"
      .Columns[7].Text = "Total"
      .Columns[8].Text = "DateTime"
      .Columns[9].Text = "Invoice"
      .Columns[10].Text = "Item Name"
      .Columns[11].Text = "Order"
      .Columns[12].Text = "Sale"

    Else If $strType = "ClaimCodes"
      .Columns[0].Width = 125 * modBasic.$AppWidthRatio
      .Columns[1].Width = 125 * modBasic.$AppWidthRatio
      .Columns[2].Width = 150 * modBasic.$AppWidthRatio
      .Columns[3].Width = 100 * modBasic.$AppWidthRatio

      .Columns[0].Text = "Codes"
      .Columns[1].Text = "Encounter"
      .Columns[2].Text = "DateTime"
      .Columns[3].Text = "User"

    Else If $strType = "Invoice/Receipt"
      .Columns[0].Width = 150 * modBasic.$AppWidthRatio
      .Columns[1].Width = 125 * modBasic.$AppWidthRatio
      .Columns[2].Width = 75 * modBasic.$AppWidthRatio
      .Columns[3].Width = 125 * modBasic.$AppWidthRatio
      .Columns[4].Width = 125 * modBasic.$AppWidthRatio
      .Columns[5].Width = 75 * modBasic.$AppWidthRatio
      .Columns[6].Width = 75 * modBasic.$AppWidthRatio

      .Columns[0].Text = "DateTime"
      .Columns[1].Text = "Invoice"
      .Columns[2].Text = "Type"
      .Columns[3].Text = "Account"
      .Columns[4].Text = "Reference"
      .Columns[5].Text = "TotalAMT"
      .Columns[6].Text = "Received"

    Else If $strType = "ArchivedReports" Then
      .Columns[0].Width = 1
      .Columns[1].Width = 150 * modBasic.$AppWidthRatio
      .Columns[2].Width = 125 * modBasic.$AppWidthRatio
      .Columns[3].Width = 150 * modBasic.$AppWidthRatio
      .Columns[4].Width = 250 * modBasic.$AppWidthRatio
      .Columns[5].Width = 1
      .Columns[6].Width = 1
      .Columns[7].Width = 1

      .Columns[1].Text = "DateTime"
      .Columns[2].Text = "Encounter"
      .Columns[3].Text = "Title"
      .Columns[4].Text = "Comment"

    Else If $strType = "ArchivedRepoReports" Then
      .Columns[0].Width = 1
      .Columns[1].Width = 150 * modBasic.$AppWidthRatio
      .Columns[2].Width = 125 * modBasic.$AppWidthRatio
      .Columns[3].Width = 150 * modBasic.$AppWidthRatio
      .Columns[4].Width = 250 * modBasic.$AppWidthRatio
      .Columns[5].Width = 1
      .Columns[6].Width = 1
      .Columns[7].Width = 1
      .Columns[8].Width = 75 * modBasic.$AppWidthRatio
      .Columns[9].Width = 25 * modBasic.$AppWidthRatio

      .Columns[1].Text = "DateTime"
      .Columns[2].Text = "Encounter"
      .Columns[3].Text = "Title"
      .Columns[4].Text = "Comment"
      .Columns[8].Text = "HF"

    Else If $strType = "Pharmacy:Cancelled" Then
      .Columns[0].Width = 1
      .Columns[1].Width = 150 * modBasic.$AppWidthRatio
      .Columns[2].Width = 225 * modBasic.$AppWidthRatio
      .Columns[3].Width = 75 * modBasic.$AppWidthRatio
      .Columns[4].Width = 50 * modBasic.$AppWidthRatio
      .Columns[5].Width = 50 * modBasic.$AppWidthRatio
      .Columns[6].Width = 50 * modBasic.$AppWidthRatio
      .Columns[7].Width = 100 * modBasic.$AppWidthRatio
      .Columns[8].Width = 100 * modBasic.$AppWidthRatio
      .Columns[9].Width = 100 * modBasic.$AppWidthRatio
      .Columns[10].Width = 100 * modBasic.$AppWidthRatio
      .Columns[11].Width = 100 * modBasic.$AppWidthRatio
      .Columns[12].Width = 150 * modBasic.$AppWidthRatio

      .Columns[1].Text = "Req.Date"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "Dose"
      .Columns[4].Text = "Freq"
      .Columns[5].Text = "Days"
      .Columns[6].Text = "QTY"
      .Columns[7].Text = "Status"
      .Columns[8].Text = "Cancelled"
      .Columns[9].Text = "Req.Comp"
      .Columns[10].Text = "Disp.User"
      .Columns[11].Text = "Disp.Comp"
      .Columns[12].Text = "Disp.Date"

    Else If $strType = "PurchaseReference" Then
      .Columns[0].Width = 125 * modBasic.$AppWidthRatio
      .Columns[1].Width = 100 * modBasic.$AppWidthRatio
      .Columns[2].Width = 275 * modBasic.$AppWidthRatio
      .Columns[3].Width = 100 * modBasic.$AppWidthRatio
      .Columns[4].Width = 125 * modBasic.$AppWidthRatio
      .Columns[5].Width = 75 * modBasic.$AppWidthRatio
      .Columns[6].Width = 75 * modBasic.$AppWidthRatio
      .Columns[7].Width = 75 * modBasic.$AppWidthRatio
      .Columns[8].Width = 100 * modBasic.$AppWidthRatio
      .Columns[9].Width = 100 * modBasic.$AppWidthRatio

      .Columns[0].Text = "Date"
      .Columns[1].Text = "Category"
      .Columns[2].Text = "Particulars"
      .Columns[3].Text = "Batch"
      .Columns[4].Text = "Expiry"
      .Columns[5].Text = "Rate"
      .Columns[6].Text = "Free"
      .Columns[7].Text = "QTY"
      .Columns[8].Text = "NetCost"
      .Columns[9].Text = "Total"

    Endif

  End With

End

Public Sub mnudetreport_Click()

  If GridView1.Rows.Selection.Count > 0 Then
    If $strType = "PatientEncounters" Then
      modPatReports.GetSelectedPatientValues(GridView1[GridView1.Row, 0].Text, MMain.$defUnit)
    Else If $strType = "PatientRemoteEncounters" Then
      modPatReports.GetSelectedPatientValues(GridView1[GridView1.Row, 0].Text, MMain.$defUnit)
    Endif
  Endif

End

Public Sub GridView1_Menu()

  If $strType = "PatientEncounters" Or If $strType = "PatientRemoteEncounters" Then
    mnuhide.Popup
  Endif

End

Public Sub Form_KeyRelease()

  If Key.Code = Key.Esc Then
    Me.Close
  Endif

End

Public Sub mnuexpo_Click()

  modCHTMLReport.ExportGridToHTML(GridView1, Me.Title, modReportVar.GetDateTimeReport(Now(), gb.GeneralDate))

End

Public Sub mnutransfer_Click()

  modGridView.ExportGridToSqlite(GridView1)

End

Public Sub mnugenimage_Click()

  Dim hForm As FmPatImage

  If GridView1.Rows.Selection.Count Then
    hForm = New FmPatImage("IMAGE", GridView1[GridView1.Row, 0].Text, "")
    hForm.ShowModal
  Endif

End

Public Sub mnudicom_Click()

  Dim hForm As FmPatImage

  If GridView1.Rows.Selection.Count Then
    hForm = New FmPatImage("DICOM", GridView1[GridView1.Row, 0].Text, "")
    hForm.ShowModal
  Endif

End

Public Sub mnupacs_Click()

  Dim hForm As FmPacsFind

  If GridView1.Rows.Selection.Count Then
    hForm = New FmPacsFind(GridView1[GridView1.Row, 0].Text, "Visit")
    hForm.ShowModal
  Endif

End

Public Sub mnubill_Click()

  Dim xPath As String

  If GridView1.Rows.Selection.Count Then
    Inc Application.Busy
    xPath = modCHTMLInvoice.ShowTotalInvoicebyPatient(GridView1[GridView1.Row, 0].Text, "Complete")
    Dec Application.Busy
    modControlSub.OpenHTMLPreview(GridView1[GridView1.Row, 0].Text, xPath, "ReportSize")
  Endif

End

Public Sub mnumovement_Click()

  Dim xcoord As String[]
  Dim xList As String[]
  Dim hForm As FmWebView

  xList = New String[]
  For Each $rData
    xcoord = modDataRepo.GetGeoCoordinates($rData["fldhospcode"])
    If xcoord Then
      If xcoord[0] And If xcoord[1] Then
        xList.Add(xcoord[0] & "," & xcoord[1])
      Endif
    Endif
  Next
  If xList.Count Then
    hForm = New FmWebView("https://www.google.com/maps/dir/" & xList.Join("/"))
    modAppSupport.FindWorSpace(modHelpVariable.$LogInCategory).Add(hForm)
  Endif

End

Public Sub mnuopenfile_Click()

  Dim xpath As String

  If GridView1.Rows.Selection.Count > 0 Then
    If $strType = "ArchivedRepoReports" Then
      xpath = modImage.GetBlobFileRemoteData(GridView1[GridView1.Row, 0].Text)
    Else
      xpath = modImage.GetBlobFileData(GridView1[GridView1.Row, 0].Text)
    Endif
    If Exist(xpath) Then
      modDevice.DesktopOpenFile(xpath)
    Endif
  Endif

End

Public Sub mnuprint_Click()

  Dim xpath As String

  If GridView1.Rows.Selection.Count > 0 Then
    If $strType = "ArchivedRepoReports" Then
      xpath = modImage.GetBlobFileRemoteData(GridView1[GridView1.Row, 0].Text)
    Else
      xpath = modImage.GetBlobFileData(GridView1[GridView1.Row, 0].Text)
    Endif
    If Exist(xpath) Then
      modPrint.DefaultPrinting(xpath, "ReportSize")
    Endif
  Endif

End

Public Sub mnuemail_Click()

  Dim xpath As String
  Dim hForm As FmRemoteMail
  Dim xx As String[]

  If GridView1.Rows.Selection.Count > 0 Then
    If $strType = "ArchivedRepoReports" Then
      xpath = modImage.GetBlobFileRemoteData(GridView1[GridView1.Row, 0].Text)
    Else
      xpath = modImage.GetBlobFileData(GridView1[GridView1.Row, 0].Text)
    Endif
    If Exist(xpath) Then
      xx = New String[]
      xx.Add(modPatient.GetPatientEmail(GridView1[GridView1.Row, 7].Text))
      hForm = New FmRemoteMail(xx, xpath, "Report", GridView1[GridView1.Row, 3].Text)
      hForm.ShowModal()
    Endif
  Endif

End

Public Sub GridView1_Click()

  Dim xpath As String

  If GridView1.Column = 9 Then
    If $strType = "ArchivedRepoReports" Then
      xpath = modImage.GetBlobFileRemoteData(GridView1[GridView1.Row, 0].Text)
      If Exist(xpath) Then
        modDevice.DesktopOpenFile(xpath)
      Endif
    Endif
  Endif

End
