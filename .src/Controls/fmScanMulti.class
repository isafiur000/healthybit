' Gambas class file

Private $encid As String
Private $sType As String
Private $ImgList As String[]

Public Sub _new(encid As String, sType As String)

  $encid = encid
  $sType = sType

End

Public Sub Form_Open()

  modGeneralMain.ArrangeFormCentre(Me)
  txtpatientname.Text = modPatient.GetPatientNameByEnc($encid)
  $ImgList = New String[]

End

Public Sub Form_Resize()

  modGeneralMain.ShowSelectedFormMenu(Me)

End

Public Sub Form_Close()

  modGeneralMain.RecordFormExit(Me)

End

Public Sub btnfolder_Click()

  Dim FileList As String[]
  Dim sFile As String

  If Dialog.SelectDirectory() Then Return
  btnfolder.Tag = Dialog.Path
  txtpath.Text = btnfolder.Tag
  If btnfolder.Tag Then
    FileList = Dir(btnfolder.Tag, Null, gb.File)
    For Each sFile In FileList
      $ImgList.Add(btnfolder.Tag &/ sFile)
    Next
    Balloon.Info($ImgList.Count & " Documents Added", btnfolder)
    Balloon.Delay = modBasic.$BalloonDelay
  Endif

End

Public Sub btnsaveimg_Click()

  Dim sPath As String
  Dim i As Integer
  Dim sLongID As Long

  ProgressBar1.Value = 0
  i = 1
  If $ImgList.Count Then
    For Each sPath In $ImgList
      sLongID = modImage.SavePatientFileGeneral($encid, $sType, File.BaseName(sPath), sPath)                    ''
      ProgressBar1.Value = i / $ImgList.Count
      Wait

      i = i + 1
    Next
    If sLongID Then
      Balloon.Info(("File saved"), btnsaveimg)
      Balloon.Delay = modBasic.$BalloonDelay
    Endif
  Endif

End
